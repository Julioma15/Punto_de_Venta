name: CI/CD Build and Deploy

on:
  push:
    branches: [ "main" ] # O "master", según cómo se llame tu rama principal

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
    # 1. Bajar el código
    - name: Checkout code
      uses: actions/checkout@v4

    # 2. Iniciar sesión en GitHub Container Registry
    - name: Login to GitHub Container Registry
      uses: docker/login-action@v3
      with:
        registry: ghcr.io
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}

    # 3. Construir y subir la imagen Docker
    - name: Build and push Docker image
      uses: docker/build-push-action@v5
      with:
        context: .
        push: true
        # Reemplaza 'tu_usuario' con tu usuario de GitHub en minúsculas y 'nombre_repo' con el nombre de tu repo
        tags: ghcr.io/julioma15/punto_de_venta:latest

    # 4. Avisar a Render para que actualice (CD)
    # Este paso fallará la primera vez porque aún no tenemos la URL de Render, no te preocupes.
    - name: Trigger Render Deploy
      if: success()
      run: curl "${{ secrets.RENDER_DEPLOY_HOOK }}"
